<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
</head>
<body>
	
	<script type="text/javascript">
		//RIDICULOUSLY LONG WAY TO SOLVE THE PROBLEM OF AUNT EMILY'S CATS
		//ARCHIVE IS THE ARCHIVE OF ALL OF THE PREVIOUS E-MAILS
		//SEARCHING FOR LINES OF TEXT THAT MIGHT BEGIN
		//died 12/31/2007: Mr. Mittens
		//born 03/02/1999: Spot Kitty, Captain Fun, Sugarbear
		

		//REFACTOR 2
		function findLivingCats() {
			var livingCats = {"Spot": true};

			function handleParagraph(paragraph) {
				//This is in here as a function because it's only relevant to findLivingCats()
				//and not a more generalized function.
				if(startsWith(paragraph, "born"))
					addToSet(livingCats, catNames(paragraph));
				else if (startsWith(paragraph, "died")) 
					removeFromSet(livingCats, catNames(paragraph));
			}

			for (var mail = 0; mail < ARCHIVE.length; mail++) {
				var paragraphs = ARCHIVE[mail].split("\n");
				for (var i = 0; i < paragraphs.length; i++) 
					handleParagraph(paragraphs[i]);
			}

			return livingCats;
		}

		function startsWith(string, pattern) {
			//checks to see if a string starts with a pattern
			return string.slice(0, pattern.length) == pattern;
		}

		function catNames(paragraph) {
			var colon = paragraph.indexOf(":");
			return paragraph.slice(colon + 2).split(", ");
			/* If Aunt Emily writes:
			born 12/12/2003: Mr. Misstopholes, Boo Kitty, Happy Cat

			This function will split it in to:
			["Mr. Misstopholes", "Boo Kitty", "Happy Cat"] */
		}

		//FUNCTIONS ADDED FOR REFACTOR 1
		function addToSet(set, values) {
			for (var i = 0; i < values.length; i++)
				set[values[i]] = true;
		}

		function removeFromSet(set, values) {
			for (var i = 0; i < values.length; i++)
				delete set[values[i]];
		}
	</script>
</body>
</html>